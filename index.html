<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Flowchart Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    #autocompleteResults {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      z-index: 50;
      text-align: left;
    }
    #autocompleteResults div {
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    #autocompleteResults div:hover {
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-white text-gray-900 font-sans">
  <div class="container mx-auto py-16 px-4 text-center">
    <h1 class="text-3xl font-bold mb-8">Generate a Flowchart</h1>

    <div class="max-w-xl mx-auto relative">
      <input id="promptInput" type="text" placeholder="Type your prompt..." class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" oninput="showAutocomplete(this.value)" />
      <div id="autocompleteResults" class="hidden"></div>
      <button onclick="generateFlowchart()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition">Generate Flowchart</button>
      <p class="mt-4 text-sm text-blue-500 cursor-pointer" onclick="showExamples()">Example Prompts</p>
    </div>

    <div id="flowchart" class="mt-12"></div>
  </div>

  <!-- Modal -->
  <div id="exampleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
      <h2 class="text-xl font-semibold mb-4">Example Prompts</h2>
      <ul class="text-left space-y-2">
        <li>ðŸŽ® "I want to make a game"</li>
        <li>ðŸŽ¨ "What tools generate concept art?"</li>
        <li>ðŸŽ§ "Find AI music generators"</li>
      </ul>
      <button onclick="hideExamples()" class="mt-6 bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800">Close</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.0/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: false });

    let db = {};

    fetch("data/AIDB.json")
      .then((res) => res.json())
      .then((json) => {
        db = json;
        console.log("Loaded and converted AIDB.json:", db);
      })
      .catch((err) => console.error("Failed to load AIDB.json", err));

    function showExamples() {
      document.getElementById("exampleModal").classList.remove("hidden");
    }

    function hideExamples() {
      document.getElementById("exampleModal").classList.add("hidden");
    }

    const simplifiedPromptMap = [
      ["create ai tool", /ai tool/],
      ["generate images", /generate.*image|image generation/],
      ["create chatbot", /chatbot|chat bot/],
      ["build website", /build.*website|website builder/],
      ["create music", /create.*music|music generation/],
      ["code assistant", /code assistant|code completion|copilot/],
      ["3d modeling", /3d.*model/],
      ["generate voice", /voice generation|text to speech/],
      ["transcribe audio", /transcribe|speech to text|whisper/],
      ["generate text", /generate.*text|text generation/],
      ["summarize text", /summarize|tl;dr/],
      ["create presentation", /create.*presentation|slide/],
      ["generate avatar", /avatar|character creator/],
      ["game design", /create.*game|game design/],
      ["app builder", /build.*app|app generator/],
      ["productivity assistant", /ai productivity|task automation/],
      ["generate video", /generate.*video|video ai/],
      ["logo design", /logo/],
      ["write blog", /write.*blog|blog assistant/],
      ["ai search", /ai search|smart search/],
      ["startup tools", /startup|founder|pitch/]
    ];

    function simplifyPrompt(prompt) {
      const cleaned = prompt.toLowerCase();
      for (let [label, pattern] of simplifiedPromptMap) {
        if (pattern.test(cleaned)) return `<b>${label.charAt(0).toUpperCase() + label.slice(1)}</b>`;
      }
      return "<b>User Prompt</b>";
    }

    function showAutocomplete(input) {
      const box = document.getElementById("autocompleteResults");
      if (!input || input.length < 2) return (box.classList.add("hidden"));

      const matches = simplifiedPromptMap
        .map(([label]) => label)
        .filter(label => label.toLowerCase().includes(input.toLowerCase()));

      if (matches.length === 0) return box.classList.add("hidden");

      box.innerHTML = matches.map(m => `<div onclick='selectAutocomplete("${m}")'>${m}</div>`).join("");
      box.classList.remove("hidden");
    }

    function selectAutocomplete(text) {
      const input = document.getElementById("promptInput");
      input.value = text;
      document.getElementById("autocompleteResults").classList.add("hidden");
    }

    function generateFlowchart() {
      const prompt = document.getElementById("promptInput").value.toLowerCase();
      const flowchartEl = document.getElementById("flowchart");
      const tools = db.Tools || {};
      const categories = db.Categories || {};

      const matchedCats = Object.entries(categories).filter(([cat, details]) => {
        const keywords = details.Keywords.toLowerCase().split(",");
        return keywords.some(kw => prompt.includes(kw.trim()));
      });

      if (matchedCats.length === 0) {
        flowchartEl.innerHTML = '<p class="text-red-600">No matching tools found.</p>';
        return;
      }

      const simplified = simplifyPrompt(prompt);
      let diagram = `graph TD\nStart[\"${simplified}\"]\n`;
      let classLines = "";

      matchedCats.forEach(([cat, info]) => {
        const catId = cat.toLowerCase();
        diagram += `${catId}[\"${cat.toUpperCase()}\"]\n`;
        diagram += `Start --> ${catId}\n`;

        const topToolName = info["Top Tool"];
        const topTool = tools[topToolName];
        if (topTool) {
          const nodeId = `${catId}_top`;
          diagram += `${nodeId}[\"<a href='${topTool.Website}' target='_blank'><b>${topToolName}</b></a>\"]\n`;
          diagram += `${catId} --> ${nodeId}\n`;
          classLines += `class ${nodeId} top;\n`;
        }

        const altTools = (info["Alt Tools"] || "").split(",").map(t => t.trim());
        altTools.forEach((altName, idx) => {
          const altTool = tools[altName];
          if (altTool) {
            const nodeId = `${catId}_alt_${idx}`;
            diagram += `${nodeId}[\"<a href='${altTool.Website}' target='_blank'>${altName}</a>\"]\n`;
            diagram += `${catId} --> ${nodeId}\n`;
            classLines += `class ${nodeId} alt;\n`;
          }
        });
      });

      diagram += classLines;
      diagram += "classDef top fill:#bbf7d0,stroke:#15803d,stroke-width:2px,color:#065f46,font-weight:bold;\n";
      diagram += "classDef alt fill:#f3f4f6,stroke:#4b5563,stroke-width:1px,color:#374151;\n";

      flowchartEl.innerHTML = `<pre class='mermaid'>${diagram}</pre>`;
      mermaid.run();
    }
  </script>
</body>
</html>
